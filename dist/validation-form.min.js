/*!
 * validation-form.js
 * ------------------
 * @version 0.1.0 (2016-03-27)
 * @author mach3 <mach3ss@gmail.com>
 * @license MIT
 * @requires jQuery
 */
!function(a){var b={toArray:function(a){return Array.prototype.slice.call(a)},type:function(a,b){var c,d;return c=Object.prototype.toString.call(a).match(/\[object\s(\w+)\]/),d=c?c[1]:"Unknown",b?b===d:d},delegate:function(c){a.each(c,function(a,d){/^_[a-z]/.test(a)&&b.type(d,"Function")&&(c[a]=d.bind(c))})},format:function(){var a=this.toArray(arguments);return a.shift().replace(/%s/g,function(){return a.length?a.shift():""})},render:function(a,b){return a.replace(/\{\{(\w+)\}\}/g,function(a,c){return c in b?b[c]:""})}};a.ValidationForm=function(c,d){this.el=a(c),this.config(d),b.delegate(this),this.rules={},this.filters={},this.el.on(this.config("validateEvent"),"input[name], textarea[name], select[name]",this._onValidate).on("submit",this._onSubmit)},a.extend(a.ValidationForm.prototype,{EVENT_VALIDATED:"validated",EVENT_ERROR:"error",el:null,rules:null,filters:null,_options:{submit:!0,format:"(\\w+)(?:\\((.+?)\\))?\\s?(?:{{delimiter}}|$)",delimiter:";",validateEvent:"change blur",defaultMessage:"Invalid input",messages:null,messageClassName:"validation-message",messagePosition:"after",messageFade:!0,messageDuration:300},config:function(){var c=b.toArray(arguments);switch(this.options=this.options||a.extend(!0,{},this._options),b.type(c[0])){case"Undefined":return this.options;case"Object":return a.extend(!0,this.options,c[0]),this;case"String":return 1===c.length?this.options[c[0]]:(this.options[c[0]]=c[1],this)}return this},_onSubmit:function(a){var b=!0,c=this;this.el.find("input, textarea, select").filter("[name]").each(function(){c.validate(this)||(b=!1)}),b&&this.config("submit")||a.preventDefault(),this.el.trigger(b?this.EVENT_VALIDATED:this.EVENT_ERROR)},_onValidate:function(a){this.validate(a.currentTarget)},validate:function(b){var c,d,e,f,g,h,i,j=this;return c=this.el.serializeObject(),d=this.parseRules(b),e=this.parseFilters(b),f=a.ValidationForm.Valid,g=a.ValidationForm.Filter,h=null,e&&e.forEach(function(a){a.name in g&&g[a.name].apply(b,a.args)}),a.each(this.rules,function(a,c){c.equals===b.name&&j.validate(j.getElementByName(a))}),d?c[b.name]?d.items.length&&(d.items.forEach(function(a){h||a.name in f&&(f[a.name].apply(b,a.args)||(h=a.name))}),h)?this.message(b,h):d.equals&&(i=this.getElementByName(d.equals),i&&i.value!==b.value)?this.message(b,"equals"):this.message(b,!1):d.required?this.message(b,"required"):this.message(b,!1):this.message(b,!1)},getElementByName:function(a){var c=this.el.find(b.format("[name=%s]",a));return c.length?c[0]:null},message:function(c,d){var e,f,g,h;return e=this.config(),f=function(){return d?e.messages&&e.messages[c.name]&&e.messages[c.name][d]?e.messages[c.name][d]:e.defaultMessage:null}(),g=this.el.find(b.format(".%s[data-for=%s]",e.messageClassName,c.name)),g=g.length?g:a("<div>",{"class":e.messageClassName,"data-for":c.name})["before"===e.messagePosition?"insertBefore":"insertAfter"](c).hide(),h=a(c).toggleClass("invalid",!!f).toggleClass("valid",!f),f?(g.text(f).stop()[e.messageFade?"fadeIn":"show"](e.messageDuration),h.trigger("invalid")):g.stop()[e.messageFade?"fadeOut":"hide"](e.messageDuration),!f},parseRules:function(c){var d,e,f,g,h=this;return c.name in this.rules?this.rules[c.name]:(d=this.config(),e=a(c).data("validation"),f={required:!1,equals:null,items:[]},g=new RegExp(b.render(d.format,{delimiter:d.delimiter}),"g"),e?(e.replace(g,function(a,b,c){return"required"===b?void(f.required=!0):"equals"===b?void(f.equals=c):void f.items.push({name:b,args:h.parseArgs(c)})}),this.rules[c.name]=f,f):null)},parseFilters:function(c){var d,e,f,g=[],h=this;return c.name in this.filters?this.filters[c.name]:(d=this.config(),e=a(c).data("filter"),f=new RegExp(b.render(d.format,{delimiter:d.delimiter}),"g"),e?(e.replace(f,function(a,b,c){g.push({name:b,args:h.parseArgs(c)})}),this.filters[c.name]=g,g):null)},parseArgs:function(c){var d,e,f=[],g=[];return b.type(c,"String")?(d={regex:/\/(.+?)\/\s?(,|$)/g,string:/'(.+)'\s?(,|$)/g},e=c.replace(d.regex,function(a,b,c){return f.push(new RegExp(b)),"__REGEX__"+c}).replace(d.string,function(a,b,c){return g.push(b),"__STRING__"+c}).split(",").map(function(b){switch(b=a.trim(b),!0){case/__REGEX__/.test(b):return f.shift();case/__STRING__/.test(b):return g.shift();case/^\d+(\.\d+)?$/.test(b):return Number(b)}return b})):[]}}),a.ValidationForm.Valid={length:function(a,b){var c=this.value.length;return c>=a&&b>=c},range:function(a,b){var c=Number(this.value);return a=Number(a),b=Number(b),c>=a&&b>=c},email:function(){var a=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;return a.test(this.value)},url:function(a){var c,d,e,f,g,h;return c="(https|http)://",d="(\\d{1,3}(\\.\\d{1,3}){3})",e="([a-z0-9\\-]+(\\.[a-z0-9\\-]+)*?)",f="(:[\\d]{1,5})",g="[^\\\\'\\|`\\^\"<>\\(\\)\\{\\}\\[\\]]+",h=new RegExp(b.format("^%s(%s|%s)(%s)?(%s)?$",c,d,e,f,g)),h.test(this.value)},number:function(){return/^\d+(\.\d+)?$/.test(this.value)},integer:function(){return/^\d+$/.test(this.value)},pattern:function(a){return a.test(this.value)}},a.ValidationForm.Filter={trim:function(){this.value=a.trim(this.value)},replace:function(a,b){this.value=this.value.replace(a,b)},zenhan:function(){var a,c;a={han:[49,50,51,52,53,54,55,56,57,48,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,45,94,92,33,34,35,36,37,38,39,40,41,61,126,124,96,123,43,42,125,60,62,63,95,64,91,59,58,93,44,46,47,45],zen:[65297,65298,65299,65300,65301,65302,65303,65304,65305,65296,65345,65346,65347,65348,65349,65350,65351,65352,65353,65354,65355,65356,65357,65358,65359,65360,65361,65362,65363,65364,65365,65366,65367,65368,65369,65370,65313,65314,65315,65316,65317,65318,65319,65320,65321,65322,65323,65324,65325,65326,65327,65328,65329,65330,65331,65332,65333,65334,65335,65336,65337,65338,65293,65342,65509,65281,8221,65283,65284,65285,65286,8217,65288,65289,65309,65374,65372,65344,65371,65291,65290,65373,65308,65310,65311,65343,65312,65339,65307,65306,65341,65292,65294,65295,8722]},c=b.toArray(this.value).map(function(b){var c=a.zen.indexOf(b.charCodeAt(0));return 0>c?b:String.fromCharCode(a.han[c])}),this.value=c.join("")}},a.fn.extend({validationForm:function(b){var c="__validationFormInstance__";return this.each(function(){c in this||(this[c]=new a.ValidationForm(this,b))})},serializeObject:function(){var a={};return this.serializeArray().forEach(function(c){return c.name in a?(b.type(a[c.name],"Array")||(a[c.name]=[a[c.name]]),void a[c.name].push(c.value)):void(a[c.name]=c.value)}),a},submitAsync:function(b){var c,d=this.eq(0);return c=function(){var a={},c=d.serializeObject();return b?(a[b]=JSON.stringify(c),a):c}(),a.ajax({url:d.prop("action"),type:d.prop("method"),data:c})}})}(jQuery);